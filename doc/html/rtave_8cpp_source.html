<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.9.1"/>
<title>MNE-CPP: D:/Users/Christoph/GitHub/mne-cpp/MNE/rtInv/rtave.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">MNE-CPP
   &#160;<span id="projectnumber">beta 1.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.9.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_fba7b6d30909f9ec66000534e18b073e.html">MNE</a></li><li class="navelem"><a class="el" href="dir_033466febd60a68f23401bec31fff635.html">rtInv</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">rtave.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="rtave_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">//=============================================================================================================</span></div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="comment"></span><span class="comment">//*************************************************************************************************************</span></div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="comment">//=============================================================================================================</span></div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="comment">// INCLUDES</span></div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="comment">//=============================================================================================================</span></div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="rtave_8h.html">rtave.h</a>&quot;</span></div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="ioutils_8h.html">utils/ioutils.h</a>&gt;</span></div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="comment">//*************************************************************************************************************</span></div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="comment">//=============================================================================================================</span></div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="comment">// QT INCLUDES</span></div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="comment">//=============================================================================================================</span></div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="preprocessor">#include &lt;QMutexLocker&gt;</span></div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="preprocessor">#include &lt;QDebug&gt;</span></div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="comment">//*************************************************************************************************************</span></div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="comment">//=============================================================================================================</span></div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="comment">// USED NAMESPACES</span></div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<span class="comment">//=============================================================================================================</span></div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="keyword">using namespace </span><a class="code" href="namespace_r_t_i_n_v_l_i_b.html">RTINVLIB</a>;</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;<span class="keyword">using namespace </span><a class="code" href="namespace_f_i_f_f_l_i_b.html">FIFFLIB</a>;</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;<span class="keyword">using namespace </span><a class="code" href="namespace_u_t_i_l_s_l_i_b.html">UTILSLIB</a>;</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;<span class="comment">//*************************************************************************************************************</span></div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;<span class="comment">//=============================================================================================================</span></div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;<span class="comment">// DEFINE MEMBER METHODS</span></div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;<span class="comment">//=============================================================================================================</span></div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;</div>
<div class="line"><a name="l00074"></a><span class="lineno"><a class="line" href="class_r_t_i_n_v_l_i_b_1_1_rt_ave.html#ab905110d161ee2a62dc32f4812ecf9b0">   74</a></span>&#160;<a class="code" href="class_r_t_i_n_v_l_i_b_1_1_rt_ave.html#ab905110d161ee2a62dc32f4812ecf9b0">RtAve::RtAve</a>(quint32 numAverages, quint32 p_iPreStimSamples, quint32 p_iPostStimSamples, <a class="code" href="class_f_i_f_f_l_i_b_1_1_fiff_info.html#abfce6128814de61b3fdd324a97918338">FiffInfo::SPtr</a> p_pFiffInfo, QObject *parent)</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;: QThread(parent)</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;, m_iNumAverages(numAverages)</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;, m_iPreStimSamples(p_iPreStimSamples)</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;, m_iPostStimSamples(p_iPostStimSamples)</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;, m_pFiffInfo(p_pFiffInfo)</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;, m_bIsRunning(false)</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;, m_bAutoAspect(true)</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;{</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    qRegisterMetaType&lt;FiffEvoked::SPtr&gt;(<span class="stringliteral">&quot;FiffEvoked::SPtr&quot;</span>);</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;}</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;<span class="comment">//*************************************************************************************************************</span></div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;</div>
<div class="line"><a name="l00089"></a><span class="lineno"><a class="line" href="class_r_t_i_n_v_l_i_b_1_1_rt_ave.html#a17f21c3faa0eeeccae2fc04f9ce9515f">   89</a></span>&#160;<a class="code" href="class_r_t_i_n_v_l_i_b_1_1_rt_ave.html#a17f21c3faa0eeeccae2fc04f9ce9515f">RtAve::~RtAve</a>()</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;{</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;    <span class="keywordflow">if</span>(this-&gt;<a class="code" href="class_r_t_i_n_v_l_i_b_1_1_rt_ave.html#abf42ab0f2d2112f712771a553f48e252">isRunning</a>())</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;        <a class="code" href="class_r_t_i_n_v_l_i_b_1_1_rt_ave.html#a6152aaeb0cb1aef0d4cffa21b91ba7ce">stop</a>();</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;}</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;<span class="comment">//*************************************************************************************************************</span></div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;</div>
<div class="line"><a name="l00098"></a><span class="lineno"><a class="line" href="class_r_t_i_n_v_l_i_b_1_1_rt_ave.html#a93644080694b38ba14f990525828f6e1">   98</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_r_t_i_n_v_l_i_b_1_1_rt_ave.html#a93644080694b38ba14f990525828f6e1">RtAve::append</a>(<span class="keyword">const</span> MatrixXd &amp;p_DataSegment)</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;{</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    QMutexLocker locker(&amp;m_qMutex);</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;    <span class="comment">// ToDo handle change buffersize</span></div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;    <span class="keywordflow">if</span>(!m_pRawMatrixBuffer)</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;        m_pRawMatrixBuffer = <a class="code" href="class_i_o_buffer_1_1_circular_matrix_buffer.html#a27289313f8c9d93db4e02703e2033e8f">CircularMatrixBuffer&lt;double&gt;::SPtr</a>(<span class="keyword">new</span> <a class="code" href="class_i_o_buffer_1_1_circular_matrix_buffer.html">CircularMatrixBuffer&lt;double&gt;</a>(128, p_DataSegment.rows(), p_DataSegment.cols()));</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;    m_pRawMatrixBuffer-&gt;<a class="code" href="class_i_o_buffer_1_1_circular_matrix_buffer.html#adbba1720803e03e6b1bcd6b37f884f09">push</a>(&amp;p_DataSegment);</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;}</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;<span class="comment">//*************************************************************************************************************</span></div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;</div>
<div class="line"><a name="l00111"></a><span class="lineno"><a class="line" href="class_r_t_i_n_v_l_i_b_1_1_rt_ave.html#ad0c3ff5309ee80ce98f869a7f2297e5b">  111</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_r_t_i_n_v_l_i_b_1_1_rt_ave.html#ad0c3ff5309ee80ce98f869a7f2297e5b">RtAve::setAverages</a>(qint32 numAve)</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;{</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;    m_qMutex.lock();</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;    m_iNumAverages = numAve;</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;    m_qMutex.unlock();</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;    emit <a class="code" href="class_r_t_i_n_v_l_i_b_1_1_rt_ave.html#a9f81dcd3c06945da35e8484113f1e233">numAveragesChanged</a>();</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;}</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;<span class="comment">//*************************************************************************************************************</span></div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;</div>
<div class="line"><a name="l00122"></a><span class="lineno"><a class="line" href="class_r_t_i_n_v_l_i_b_1_1_rt_ave.html#ad0952166fc5cca924b8bcdfbd9caca2d">  122</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_r_t_i_n_v_l_i_b_1_1_rt_ave.html#ad0952166fc5cca924b8bcdfbd9caca2d">RtAve::setPreStim</a>(qint32 samples)</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;{</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;    QMutexLocker locker(&amp;m_qMutex);</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;    m_iNewPreStimSamples = samples;</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;}</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;<span class="comment">//*************************************************************************************************************</span></div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;</div>
<div class="line"><a name="l00131"></a><span class="lineno"><a class="line" href="class_r_t_i_n_v_l_i_b_1_1_rt_ave.html#af28f7254372398079b00749ebc7c7056">  131</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_r_t_i_n_v_l_i_b_1_1_rt_ave.html#af28f7254372398079b00749ebc7c7056">RtAve::setPostStim</a>(qint32 samples)</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;{</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;    QMutexLocker locker(&amp;m_qMutex);</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;    m_iNewPostStimSamples = samples;</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;}</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;<span class="comment">//*************************************************************************************************************</span></div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;<span class="keywordtype">void</span> RtAve::assemblePostStimulus(<span class="keyword">const</span> QList&lt;QPair&lt;QList&lt;qint32&gt;, MatrixXd&gt; &gt; &amp;p_qListRawMatBuf, qint32 p_iStimIdx)</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;{</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    QMutexLocker locker(&amp;m_qMutex);</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    <span class="keywordflow">if</span>(m_iPostStimSamples &gt; 0)</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;    {</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;        <span class="comment">// middle of the assembled buffers</span></div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;        <span class="keywordtype">float</span> ratio = (float)m_iPreStimSamples/((<span class="keywordtype">float</span>)(m_iPreStimSamples+m_iPostStimSamples));</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;        qint32 t_iBuffWithStim = floor((p_qListRawMatBuf.size()-1)*ratio) + 1;</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;        qint32 nrows = p_qListRawMatBuf[t_iBuffWithStim].second.rows();</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;        qint32 ncols = p_qListRawMatBuf[t_iBuffWithStim].second.cols();</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;        <span class="comment">//Stimulus channel row</span></div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;        qint32 t_iRowIdx = m_qListStimChannelIdcs[p_iStimIdx];</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;        qint32 nSampleCount = 0;</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;        MatrixXd t_matPostStim(nrows, m_iPostStimSamples);</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;        qint32 t_curBufIdx = t_iBuffWithStim;</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;        qint32 t_iSize = 0;</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;        qint32 pos = 0;</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;        p_qListRawMatBuf[t_iBuffWithStim].second.row(t_iRowIdx).maxCoeff(&amp;pos);</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;        <span class="comment">//</span></div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;        <span class="comment">// assemble poststimulus</span></div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;        <span class="comment">//</span></div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;        <span class="comment">// start from the stimulus itself</span></div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;        <span class="keywordflow">if</span>(pos &gt;= 0)</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;        {</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;            t_iSize = ncols - pos;</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;            <span class="keywordflow">if</span>(t_iSize &lt;= m_iPostStimSamples)</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;            {</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;                t_matPostStim.block(0, 0, nrows, t_iSize) = p_qListRawMatBuf[t_iBuffWithStim].second.block(0, pos, nrows, t_iSize);</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;                nSampleCount += t_iSize;</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;            }</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;            {</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;                t_matPostStim.block(0, 0, nrows, m_iPostStimSamples) = p_qListRawMatBuf[t_iBuffWithStim].second.block(0, pos, nrows, m_iPostStimSamples);</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;                nSampleCount = m_iPostStimSamples;</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;            }</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;        }</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;        ++t_curBufIdx;</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;        <span class="comment">// remaining samples</span></div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;        <span class="keywordflow">while</span>(nSampleCount &lt; m_iPostStimSamples)</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;        {</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;            t_iSize = m_iPostStimSamples-nSampleCount;</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;            <span class="keywordflow">if</span>(ncols &lt;= t_iSize)</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;            {</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;                t_matPostStim.block(0, nSampleCount, nrows, ncols) = p_qListRawMatBuf[t_curBufIdx].second.block(0, 0, nrows, ncols);</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;                nSampleCount += ncols;</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;            }</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;            {</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;                t_matPostStim.block(0, nSampleCount, nrows, t_iSize) = p_qListRawMatBuf[t_curBufIdx].second.block(0, 0, nrows, t_iSize);</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;                nSampleCount = m_iPostStimSamples;</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;            }</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;            ++t_curBufIdx;</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;        }</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;        <span class="comment">//</span></div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;        <span class="comment">//Store in right post stimulus buffer vector</span></div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;        <span class="comment">//</span></div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;        m_qListQListPostStimBuf[p_iStimIdx].append(t_matPostStim);</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;    }</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;}</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;<span class="comment">//*************************************************************************************************************</span></div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;<span class="keywordtype">void</span> RtAve::assemblePreStimulus(<span class="keyword">const</span> QList&lt;QPair&lt;QList&lt;qint32&gt;, MatrixXd&gt; &gt; &amp;p_qListRawMatBuf, qint32 p_iStimIdx)</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;{</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;    QMutexLocker locker(&amp;m_qMutex);</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;    <span class="keywordflow">if</span>(m_iPreStimSamples &gt; 0)</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;    {</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;        <span class="comment">// stimulus containing buffer of the assembled buffers</span></div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;        <span class="keywordtype">float</span> ratio = (float)m_iPreStimSamples/((<span class="keywordtype">float</span>)(m_iPreStimSamples+m_iPostStimSamples));</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;        qint32 t_iBuffWithStim = floor((p_qListRawMatBuf.size()-1)*ratio) + 1;</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;        qint32 nrows = p_qListRawMatBuf[t_iBuffWithStim].second.rows();</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;        qint32 ncols = p_qListRawMatBuf[t_iBuffWithStim].second.cols();</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;        <span class="comment">//Stimulus channel row</span></div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;        qint32 t_iRowIdx = m_qListStimChannelIdcs[p_iStimIdx];</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;        qint32 nSampleCount = m_iPreStimSamples;</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;        MatrixXd t_matPreStim(nrows, m_iPreStimSamples);</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;        qint32 t_curBufIdx = t_iBuffWithStim;</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;        qint32 t_iStart = 0;</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;        qint32 pos = 0;</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;        p_qListRawMatBuf[t_iBuffWithStim].second.row(t_iRowIdx).maxCoeff(&amp;pos);</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;        <span class="comment">//</span></div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;        <span class="comment">// assemble prestimulus</span></div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;        <span class="comment">//</span></div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;        <span class="comment">// start from the stimulus itself</span></div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;        <span class="keywordflow">if</span>(pos &gt; 0)</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;        {</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;            t_iStart = m_iPreStimSamples - pos;</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;            <span class="keywordflow">if</span>(t_iStart &gt;= 0)</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;            {</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;                t_matPreStim.block(0, t_iStart, nrows, pos) = p_qListRawMatBuf[t_iBuffWithStim].second.block(0, 0, nrows, pos);</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;                nSampleCount -= pos;</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;            }</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;            {</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;                t_matPreStim.block(0, 0, nrows, m_iPreStimSamples) = p_qListRawMatBuf[t_iBuffWithStim].second.block(0, -t_iStart, nrows, m_iPreStimSamples);</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;                nSampleCount = 0;</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;            }</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;        }</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;        --t_curBufIdx;</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;        <span class="comment">// remaining samples</span></div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;        <span class="keywordflow">while</span>(nSampleCount &gt; 0)</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;        {</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;            t_iStart = nSampleCount - ncols;</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;            <span class="keywordflow">if</span>(t_iStart &gt;= 0)</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;            {</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;                t_matPreStim.block(0, t_iStart, nrows, ncols) = p_qListRawMatBuf[t_curBufIdx].second.block(0, 0, nrows, ncols);</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;                nSampleCount -= ncols;</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;            }</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;            {</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;                t_matPreStim.block(0, 0, nrows, nSampleCount) = p_qListRawMatBuf[t_curBufIdx].second.block(0, -t_iStart, nrows, nSampleCount);</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;                nSampleCount = 0;</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;            }</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;            --t_curBufIdx;</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;        }</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;        <span class="comment">//</span></div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;        <span class="comment">//Store in right pre stimulus buffer vector</span></div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;        <span class="comment">//</span></div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;        m_qListQListPreStimBuf[p_iStimIdx].append(t_matPreStim);</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;    }</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;}</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;<span class="comment">//*************************************************************************************************************</span></div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;</div>
<div class="line"><a name="l00290"></a><span class="lineno"><a class="line" href="class_r_t_i_n_v_l_i_b_1_1_rt_ave.html#a9ecd23e84e0ebb1669250506957ac4d3">  290</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="class_r_t_i_n_v_l_i_b_1_1_rt_ave.html#a9ecd23e84e0ebb1669250506957ac4d3">RtAve::start</a>()</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;{</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;    <span class="comment">//Check if the thread is already or still running. This can happen if the start button is pressed immediately after the stop button was pressed. In this case the stopping process is not finished yet but the start process is initiated.</span></div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;    <span class="keywordflow">if</span>(this-&gt;<a class="code" href="class_r_t_i_n_v_l_i_b_1_1_rt_ave.html#abf42ab0f2d2112f712771a553f48e252">isRunning</a>())</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;        QThread::wait();</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;    m_qMutex.lock();</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;    m_bIsRunning = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;    m_qMutex.unlock();</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;    QThread::start();</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;}</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;<span class="comment">//*************************************************************************************************************</span></div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;</div>
<div class="line"><a name="l00308"></a><span class="lineno"><a class="line" href="class_r_t_i_n_v_l_i_b_1_1_rt_ave.html#a6152aaeb0cb1aef0d4cffa21b91ba7ce">  308</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="class_r_t_i_n_v_l_i_b_1_1_rt_ave.html#a6152aaeb0cb1aef0d4cffa21b91ba7ce">RtAve::stop</a>()</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;{</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;    m_qMutex.lock();</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;    m_bIsRunning = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;    m_qMutex.unlock();</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;    m_pRawMatrixBuffer-&gt;<a class="code" href="class_i_o_buffer_1_1_circular_matrix_buffer.html#a2a2115cde980084c54c138b00b3a2273">releaseFromPop</a>();</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;    m_pRawMatrixBuffer-&gt;<a class="code" href="class_i_o_buffer_1_1_circular_matrix_buffer.html#af61689beb6325a34564e76ccc674487a">clear</a>();</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;}</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;<span class="comment">//*************************************************************************************************************</span></div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;</div>
<div class="line"><a name="l00324"></a><span class="lineno"><a class="line" href="class_r_t_i_n_v_l_i_b_1_1_rt_ave.html#aa1d073fcf7b624bf8e6d4cf9aef9c3e2">  324</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_r_t_i_n_v_l_i_b_1_1_rt_ave.html#aa1d073fcf7b624bf8e6d4cf9aef9c3e2">RtAve::run</a>()</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;{</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;    <span class="comment">// Inits &amp; Clears</span></div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;    m_qMutex.lock();</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;    quint32 t_nSamplesPerBuf = 0;</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;    QList&lt;QPair&lt;QList&lt;qint32&gt;, MatrixXd&gt; &gt; t_qListRawMatBuf;</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;    <a class="code" href="class_f_i_f_f_l_i_b_1_1_fiff_evoked.html#a427a54548db07d9a54447bf6ba9243ae">FiffEvoked::SPtr</a> evoked(<span class="keyword">new</span> <a class="code" href="class_f_i_f_f_l_i_b_1_1_fiff_evoked.html">FiffEvoked</a>());</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;    VectorXd mu;</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;    qint32 i = 0;</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;    qint32 j = 0;</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;    m_qListQListPreStimBuf.clear();</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;    m_qListQListPostStimBuf.clear();</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;    m_qListPreStimAve.clear();</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;    m_qListPostStimAve.clear();</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;    m_qListStimAve.clear();</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;    <span class="comment">// get num stim channels</span></div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;    m_qListStimChannelIdcs.clear();</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;    MatrixXd t_mat;</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;    QList&lt;MatrixXd&gt; t_qListMat;</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;    <span class="keywordflow">for</span>(i = 0; i &lt; m_pFiffInfo-&gt;nchan; ++i)</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;    {</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;        <span class="keywordflow">if</span>(m_pFiffInfo-&gt;chs[i].kind == FIFFV_STIM_CH &amp;&amp; (m_pFiffInfo-&gt;chs[i].ch_name != QString(<span class="stringliteral">&quot;STI 014&quot;</span>)))</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;        {</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;            m_qListStimChannelIdcs.append(i);</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;            m_qListQListPreStimBuf.push_back(t_qListMat);</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;            m_qListQListPostStimBuf.push_back(t_qListMat);</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;            m_qListPreStimAve.push_back(t_mat);</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;            m_qListPostStimAve.push_back(t_mat);</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;            m_qListStimAve.push_back(t_mat);</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;        }</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;    }</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;    <span class="keywordtype">float</span> T = 1.0/m_pFiffInfo-&gt;sfreq;</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;    <span class="comment">// pre real-time evoked response</span></div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;    <a class="code" href="class_f_i_f_f_l_i_b_1_1_fiff_evoked.html">FiffEvoked</a> t_preStimEvoked;</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;    t_preStimEvoked.<a class="code" href="class_f_i_f_f_l_i_b_1_1_fiff_evoked.html#a937ba053abbed8b852277572379a3529">setInfo</a>(*m_pFiffInfo.data());</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;    t_preStimEvoked.<a class="code" href="class_f_i_f_f_l_i_b_1_1_fiff_evoked.html#ab678c64a099131848c27ad92b8c76c37">nave</a> = m_iNumAverages;</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;    t_preStimEvoked.<a class="code" href="class_f_i_f_f_l_i_b_1_1_fiff_evoked.html#a82f2dbb01653b5bcac2449b2195e4ef7">aspect_kind</a> = <a class="code" href="fiff__constants_8h.html#a5dab727c9be8983aee7be8d73fabe64e">FIFFV_ASPECT_AVERAGE</a>;</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;    t_preStimEvoked.<a class="code" href="class_f_i_f_f_l_i_b_1_1_fiff_evoked.html#a44df92f479c19bb5a3806d00844bfa21">times</a>.resize(m_iPreStimSamples);</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;    t_preStimEvoked.<a class="code" href="class_f_i_f_f_l_i_b_1_1_fiff_evoked.html#a44df92f479c19bb5a3806d00844bfa21">times</a>[0] = -T*m_iPreStimSamples;</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;    <span class="keywordflow">for</span>(i = 1; i &lt; t_preStimEvoked.<a class="code" href="class_f_i_f_f_l_i_b_1_1_fiff_evoked.html#a44df92f479c19bb5a3806d00844bfa21">times</a>.size(); ++i)</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;        t_preStimEvoked.<a class="code" href="class_f_i_f_f_l_i_b_1_1_fiff_evoked.html#a44df92f479c19bb5a3806d00844bfa21">times</a>[i] = t_preStimEvoked.<a class="code" href="class_f_i_f_f_l_i_b_1_1_fiff_evoked.html#a44df92f479c19bb5a3806d00844bfa21">times</a>[i-1] + T;</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;    t_preStimEvoked.<a class="code" href="class_f_i_f_f_l_i_b_1_1_fiff_evoked.html#a3dcfd87f13c3c3321e463d9d9f5ce2da">first</a> = t_preStimEvoked.<a class="code" href="class_f_i_f_f_l_i_b_1_1_fiff_evoked.html#a44df92f479c19bb5a3806d00844bfa21">times</a>[0];</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;    t_preStimEvoked.<a class="code" href="class_f_i_f_f_l_i_b_1_1_fiff_evoked.html#aebf8281e73a32ed0a7a21b3e4dbc399e">last</a> = t_preStimEvoked.<a class="code" href="class_f_i_f_f_l_i_b_1_1_fiff_evoked.html#a44df92f479c19bb5a3806d00844bfa21">times</a>[t_preStimEvoked.<a class="code" href="class_f_i_f_f_l_i_b_1_1_fiff_evoked.html#a44df92f479c19bb5a3806d00844bfa21">times</a>.size()-1];</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;    <span class="comment">// post real-time evoked full response</span></div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;    <a class="code" href="class_f_i_f_f_l_i_b_1_1_fiff_evoked.html">FiffEvoked</a> t_postStimEvoked;</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;    t_postStimEvoked.<a class="code" href="class_f_i_f_f_l_i_b_1_1_fiff_evoked.html#a937ba053abbed8b852277572379a3529">setInfo</a>(*m_pFiffInfo.data());</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;    t_postStimEvoked.<a class="code" href="class_f_i_f_f_l_i_b_1_1_fiff_evoked.html#ab678c64a099131848c27ad92b8c76c37">nave</a> = m_iNumAverages;</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;    t_postStimEvoked.<a class="code" href="class_f_i_f_f_l_i_b_1_1_fiff_evoked.html#a82f2dbb01653b5bcac2449b2195e4ef7">aspect_kind</a> = <a class="code" href="fiff__constants_8h.html#a5dab727c9be8983aee7be8d73fabe64e">FIFFV_ASPECT_AVERAGE</a>;</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;    t_postStimEvoked.<a class="code" href="class_f_i_f_f_l_i_b_1_1_fiff_evoked.html#a44df92f479c19bb5a3806d00844bfa21">times</a>.resize(m_iPostStimSamples);</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;    t_postStimEvoked.<a class="code" href="class_f_i_f_f_l_i_b_1_1_fiff_evoked.html#a44df92f479c19bb5a3806d00844bfa21">times</a>[0] = 0;</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;    <span class="keywordflow">for</span>(i = 1; i &lt; t_postStimEvoked.<a class="code" href="class_f_i_f_f_l_i_b_1_1_fiff_evoked.html#a44df92f479c19bb5a3806d00844bfa21">times</a>.size(); ++i)</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;        t_postStimEvoked.<a class="code" href="class_f_i_f_f_l_i_b_1_1_fiff_evoked.html#a44df92f479c19bb5a3806d00844bfa21">times</a>[i] = t_postStimEvoked.<a class="code" href="class_f_i_f_f_l_i_b_1_1_fiff_evoked.html#a44df92f479c19bb5a3806d00844bfa21">times</a>[i-1] + T;</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;    t_postStimEvoked.<a class="code" href="class_f_i_f_f_l_i_b_1_1_fiff_evoked.html#a3dcfd87f13c3c3321e463d9d9f5ce2da">first</a> = t_postStimEvoked.<a class="code" href="class_f_i_f_f_l_i_b_1_1_fiff_evoked.html#a44df92f479c19bb5a3806d00844bfa21">times</a>[0];</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;    t_postStimEvoked.<a class="code" href="class_f_i_f_f_l_i_b_1_1_fiff_evoked.html#aebf8281e73a32ed0a7a21b3e4dbc399e">last</a> = t_postStimEvoked.<a class="code" href="class_f_i_f_f_l_i_b_1_1_fiff_evoked.html#a44df92f479c19bb5a3806d00844bfa21">times</a>[t_postStimEvoked.<a class="code" href="class_f_i_f_f_l_i_b_1_1_fiff_evoked.html#a44df92f479c19bb5a3806d00844bfa21">times</a>.size()-1];</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;    <span class="comment">// Full real-time evoked response</span></div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;    <a class="code" href="class_f_i_f_f_l_i_b_1_1_fiff_evoked.html">FiffEvoked</a> t_stimEvoked;</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;    t_stimEvoked.<a class="code" href="class_f_i_f_f_l_i_b_1_1_fiff_evoked.html#a937ba053abbed8b852277572379a3529">setInfo</a>(*m_pFiffInfo.data());</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;    t_stimEvoked.<a class="code" href="class_f_i_f_f_l_i_b_1_1_fiff_evoked.html#ab678c64a099131848c27ad92b8c76c37">nave</a> = m_iNumAverages;</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;    t_stimEvoked.<a class="code" href="class_f_i_f_f_l_i_b_1_1_fiff_evoked.html#a82f2dbb01653b5bcac2449b2195e4ef7">aspect_kind</a> = <a class="code" href="fiff__constants_8h.html#a5dab727c9be8983aee7be8d73fabe64e">FIFFV_ASPECT_AVERAGE</a>;</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;    t_stimEvoked.<a class="code" href="class_f_i_f_f_l_i_b_1_1_fiff_evoked.html#a44df92f479c19bb5a3806d00844bfa21">times</a>.resize(m_iPreStimSamples+m_iPostStimSamples);</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;    t_stimEvoked.<a class="code" href="class_f_i_f_f_l_i_b_1_1_fiff_evoked.html#a44df92f479c19bb5a3806d00844bfa21">times</a>[0] = -T*m_iPreStimSamples;</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;    <span class="keywordflow">for</span>(i = 1; i &lt; t_stimEvoked.<a class="code" href="class_f_i_f_f_l_i_b_1_1_fiff_evoked.html#a44df92f479c19bb5a3806d00844bfa21">times</a>.size(); ++i)</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;        t_stimEvoked.<a class="code" href="class_f_i_f_f_l_i_b_1_1_fiff_evoked.html#a44df92f479c19bb5a3806d00844bfa21">times</a>[i] = t_stimEvoked.<a class="code" href="class_f_i_f_f_l_i_b_1_1_fiff_evoked.html#a44df92f479c19bb5a3806d00844bfa21">times</a>[i-1] + T;</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;    t_stimEvoked.<a class="code" href="class_f_i_f_f_l_i_b_1_1_fiff_evoked.html#a3dcfd87f13c3c3321e463d9d9f5ce2da">first</a> = t_stimEvoked.<a class="code" href="class_f_i_f_f_l_i_b_1_1_fiff_evoked.html#a44df92f479c19bb5a3806d00844bfa21">times</a>[0];</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;    t_stimEvoked.<a class="code" href="class_f_i_f_f_l_i_b_1_1_fiff_evoked.html#aebf8281e73a32ed0a7a21b3e4dbc399e">last</a> = t_stimEvoked.<a class="code" href="class_f_i_f_f_l_i_b_1_1_fiff_evoked.html#a44df92f479c19bb5a3806d00844bfa21">times</a>[t_stimEvoked.<a class="code" href="class_f_i_f_f_l_i_b_1_1_fiff_evoked.html#a44df92f479c19bb5a3806d00844bfa21">times</a>.size()-1];</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;    qint32 count = 0;</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;    m_iNewPreStimSamples = m_iPreStimSamples;</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;    m_iNewPostStimSamples = m_iPostStimSamples;</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;    m_qMutex.unlock();</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;    <span class="comment">//Enter the main loop</span></div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;    <span class="keywordflow">while</span>(<span class="keyword">true</span>)</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;    {</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;        {</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;            QMutexLocker locker(&amp;m_qMutex);</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;            <span class="keywordflow">if</span>(!m_bIsRunning)</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;        }</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;        <span class="keywordtype">bool</span> doProcessing = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;        {</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;            QMutexLocker locker(&amp;m_qMutex);</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;            <span class="keywordflow">if</span>(m_pRawMatrixBuffer)</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;                doProcessing = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;        }</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;        <span class="keywordflow">if</span>(doProcessing)</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;        {</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;            <span class="comment">//</span></div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;            <span class="comment">// Reset when stim size changed</span></div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;            <span class="comment">//</span></div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;            m_qMutex.lock();</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;            <span class="keywordflow">if</span>(m_iNewPreStimSamples != m_iPreStimSamples || m_iNewPostStimSamples != m_iPostStimSamples)</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;            {</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;                m_iPreStimSamples = m_iNewPreStimSamples;</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;                m_iPostStimSamples = m_iNewPostStimSamples;</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;                <span class="comment">// pre real-time evoked response</span></div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;                t_preStimEvoked.<a class="code" href="class_f_i_f_f_l_i_b_1_1_fiff_evoked.html#a44df92f479c19bb5a3806d00844bfa21">times</a>.resize(m_iPreStimSamples);</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;                t_preStimEvoked.<a class="code" href="class_f_i_f_f_l_i_b_1_1_fiff_evoked.html#a44df92f479c19bb5a3806d00844bfa21">times</a>[0] = -T*m_iPreStimSamples;</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;                <span class="keywordflow">for</span>(i = 1; i &lt; t_preStimEvoked.<a class="code" href="class_f_i_f_f_l_i_b_1_1_fiff_evoked.html#a44df92f479c19bb5a3806d00844bfa21">times</a>.size(); ++i)</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;                    t_preStimEvoked.<a class="code" href="class_f_i_f_f_l_i_b_1_1_fiff_evoked.html#a44df92f479c19bb5a3806d00844bfa21">times</a>[i] = t_preStimEvoked.<a class="code" href="class_f_i_f_f_l_i_b_1_1_fiff_evoked.html#a44df92f479c19bb5a3806d00844bfa21">times</a>[i-1] + T;</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;                t_preStimEvoked.<a class="code" href="class_f_i_f_f_l_i_b_1_1_fiff_evoked.html#a3dcfd87f13c3c3321e463d9d9f5ce2da">first</a> = t_preStimEvoked.<a class="code" href="class_f_i_f_f_l_i_b_1_1_fiff_evoked.html#a44df92f479c19bb5a3806d00844bfa21">times</a>[0];</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;                t_preStimEvoked.<a class="code" href="class_f_i_f_f_l_i_b_1_1_fiff_evoked.html#aebf8281e73a32ed0a7a21b3e4dbc399e">last</a> = t_preStimEvoked.<a class="code" href="class_f_i_f_f_l_i_b_1_1_fiff_evoked.html#a44df92f479c19bb5a3806d00844bfa21">times</a>[t_preStimEvoked.<a class="code" href="class_f_i_f_f_l_i_b_1_1_fiff_evoked.html#a44df92f479c19bb5a3806d00844bfa21">times</a>.size()-1];</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;                <span class="comment">// post real-time evoked full response</span></div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;                t_postStimEvoked.<a class="code" href="class_f_i_f_f_l_i_b_1_1_fiff_evoked.html#a44df92f479c19bb5a3806d00844bfa21">times</a>.resize(m_iPostStimSamples);</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;                t_postStimEvoked.<a class="code" href="class_f_i_f_f_l_i_b_1_1_fiff_evoked.html#a44df92f479c19bb5a3806d00844bfa21">times</a>[0] = 0;</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;                <span class="keywordflow">for</span>(i = 1; i &lt; t_postStimEvoked.<a class="code" href="class_f_i_f_f_l_i_b_1_1_fiff_evoked.html#a44df92f479c19bb5a3806d00844bfa21">times</a>.size(); ++i)</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;                    t_postStimEvoked.<a class="code" href="class_f_i_f_f_l_i_b_1_1_fiff_evoked.html#a44df92f479c19bb5a3806d00844bfa21">times</a>[i] = t_postStimEvoked.<a class="code" href="class_f_i_f_f_l_i_b_1_1_fiff_evoked.html#a44df92f479c19bb5a3806d00844bfa21">times</a>[i-1] + T;</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;                t_postStimEvoked.<a class="code" href="class_f_i_f_f_l_i_b_1_1_fiff_evoked.html#a3dcfd87f13c3c3321e463d9d9f5ce2da">first</a> = t_postStimEvoked.<a class="code" href="class_f_i_f_f_l_i_b_1_1_fiff_evoked.html#a44df92f479c19bb5a3806d00844bfa21">times</a>[0];</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;                t_postStimEvoked.<a class="code" href="class_f_i_f_f_l_i_b_1_1_fiff_evoked.html#aebf8281e73a32ed0a7a21b3e4dbc399e">last</a> = t_postStimEvoked.<a class="code" href="class_f_i_f_f_l_i_b_1_1_fiff_evoked.html#a44df92f479c19bb5a3806d00844bfa21">times</a>[t_postStimEvoked.<a class="code" href="class_f_i_f_f_l_i_b_1_1_fiff_evoked.html#a44df92f479c19bb5a3806d00844bfa21">times</a>.size()-1];</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;                <span class="comment">// Full real-time evoked response</span></div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;                t_stimEvoked.<a class="code" href="class_f_i_f_f_l_i_b_1_1_fiff_evoked.html#a44df92f479c19bb5a3806d00844bfa21">times</a>.resize(m_iPreStimSamples+m_iPostStimSamples);</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;                t_stimEvoked.<a class="code" href="class_f_i_f_f_l_i_b_1_1_fiff_evoked.html#a44df92f479c19bb5a3806d00844bfa21">times</a>[0] = -T*m_iPreStimSamples;</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;                <span class="keywordflow">for</span>(i = 1; i &lt; t_stimEvoked.<a class="code" href="class_f_i_f_f_l_i_b_1_1_fiff_evoked.html#a44df92f479c19bb5a3806d00844bfa21">times</a>.size(); ++i)</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;                    t_stimEvoked.<a class="code" href="class_f_i_f_f_l_i_b_1_1_fiff_evoked.html#a44df92f479c19bb5a3806d00844bfa21">times</a>[i] = t_stimEvoked.<a class="code" href="class_f_i_f_f_l_i_b_1_1_fiff_evoked.html#a44df92f479c19bb5a3806d00844bfa21">times</a>[i-1] + T;</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;                t_stimEvoked.<a class="code" href="class_f_i_f_f_l_i_b_1_1_fiff_evoked.html#a3dcfd87f13c3c3321e463d9d9f5ce2da">first</a> = t_stimEvoked.<a class="code" href="class_f_i_f_f_l_i_b_1_1_fiff_evoked.html#a44df92f479c19bb5a3806d00844bfa21">times</a>[0];</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;                t_stimEvoked.<a class="code" href="class_f_i_f_f_l_i_b_1_1_fiff_evoked.html#aebf8281e73a32ed0a7a21b3e4dbc399e">last</a> = t_stimEvoked.<a class="code" href="class_f_i_f_f_l_i_b_1_1_fiff_evoked.html#a44df92f479c19bb5a3806d00844bfa21">times</a>[t_stimEvoked.<a class="code" href="class_f_i_f_f_l_i_b_1_1_fiff_evoked.html#a44df92f479c19bb5a3806d00844bfa21">times</a>.size()-1];</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;                MatrixXd t_resetMat;</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;                t_qListRawMatBuf.clear();</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;                m_qListPreStimAve.clear();</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;                m_qListPostStimAve.clear();</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;                m_qListStimAve.clear();</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;                <span class="keywordflow">for</span>(qint32 i = 0; i &lt; m_qListQListPreStimBuf.size(); ++i)</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;                {</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;                    m_qListQListPreStimBuf[i].clear();</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;                    m_qListQListPostStimBuf[i].clear();</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;                    m_qListPreStimAve.push_back(t_resetMat);</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;                    m_qListPostStimAve.push_back(t_resetMat);</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;                    m_qListStimAve.push_back(t_resetMat);</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;                }</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;            }</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;            m_qMutex.unlock();</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;            <span class="comment">//</span></div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;            <span class="comment">// Acquire Data</span></div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;            <span class="comment">//</span></div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;            MatrixXd rawSegment = m_pRawMatrixBuffer-&gt;<a class="code" href="class_i_o_buffer_1_1_circular_matrix_buffer.html#ad22568c8be8da160dd52a98cf5f4fd46">pop</a>();</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;            <span class="keywordflow">if</span>(t_nSamplesPerBuf == 0)</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;                t_nSamplesPerBuf = rawSegment.cols();</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;            ++count;</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;            <span class="comment">//</span></div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;            <span class="comment">// Detect Stimuli</span></div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;            <span class="comment">//</span></div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;            QList&lt;qint32&gt; t_qListStimuli;</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;            <span class="keywordflow">for</span>(i = 0; i &lt; m_qListStimChannelIdcs.size(); ++i)</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;            {</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;                qint32 idx = m_qListStimChannelIdcs[i];</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;                RowVectorXi stimSegment = rawSegment.row(idx).cast&lt;<span class="keywordtype">int</span>&gt;();</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;                <span class="keywordtype">int</span> iMax = stimSegment.maxCoeff();</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;                <span class="keywordflow">if</span>(iMax &gt; 0)</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;                    t_qListStimuli.append(i);</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;            }</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;            <span class="comment">//</span></div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;            <span class="comment">// Store</span></div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;            <span class="comment">//</span></div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;            t_qListRawMatBuf.push_back(qMakePair(t_qListStimuli, rawSegment));</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;            m_qMutex.lock();</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;            qint32 minSize = (m_iPreStimSamples+m_iPostStimSamples) + (2 * t_nSamplesPerBuf);</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;            m_qMutex.unlock();</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;            <span class="keywordflow">if</span>(t_nSamplesPerBuf*t_qListRawMatBuf.size() &gt; minSize)</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;            {</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;                <span class="comment">//</span></div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;                <span class="comment">// Average</span></div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;                <span class="comment">//</span></div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;                <span class="keywordtype">float</span> ratio = (float)m_iPreStimSamples/((<span class="keywordtype">float</span>)(m_iPreStimSamples+m_iPostStimSamples));</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;                qint32 t_iBuffWithStim = floor((t_qListRawMatBuf.size()-1)*ratio) + 1;</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;                <span class="keywordflow">if</span>(t_iBuffWithStim &gt; 0 &amp;&amp; t_qListRawMatBuf[t_iBuffWithStim].first.size() != 0)</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;                {</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;                    <span class="keywordflow">for</span>(i = 0; i &lt; t_qListRawMatBuf[t_iBuffWithStim].first.size(); ++i)</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;                    {</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;                        <span class="comment">//make sure that previous buffer does not conatin this stim - prevent multiple detection</span></div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;                        <span class="keywordflow">if</span>(!t_qListRawMatBuf[t_iBuffWithStim-1].first.contains(t_qListRawMatBuf[t_iBuffWithStim].first[i]))</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;                        {</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;                            qint32 t_iStimIndex = t_qListRawMatBuf[t_iBuffWithStim].first[i];</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;                            <span class="comment">//</span></div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;                            <span class="comment">// assemble prestimulus</span></div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;                            <span class="comment">//</span></div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;                            this-&gt;assemblePreStimulus(t_qListRawMatBuf, t_iStimIndex);</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;                            <span class="comment">//</span></div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;                            <span class="comment">// assemble poststimulus</span></div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;                            <span class="comment">//</span></div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;                            this-&gt;assemblePostStimulus(t_qListRawMatBuf, t_iStimIndex);</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;                            qDebug() &lt;&lt; m_pFiffInfo-&gt;ch_names[m_qListStimChannelIdcs[t_iStimIndex]] &lt;&lt; <span class="stringliteral">&quot;: Buffer Size&quot;</span> &lt;&lt; m_qListQListPreStimBuf[t_iStimIndex].size();</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;                            <span class="comment">//</span></div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;                            <span class="comment">// Prestimulus average</span></div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;                            <span class="comment">//</span></div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;                            m_qMutex.lock();</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;                            <span class="keywordflow">if</span>(m_qListQListPreStimBuf[t_iStimIndex].size() &gt;= m_iNumAverages)</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;                            {</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;                                <span class="keywordflow">while</span>(m_qListQListPreStimBuf[t_iStimIndex].size() &gt;= (m_iNumAverages+1))<span class="comment">//if meanwhile number of averages was reduced</span></div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;                                    m_qListQListPreStimBuf[t_iStimIndex].pop_front();</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;                                m_qListPreStimAve[t_iStimIndex] = m_qListQListPreStimBuf[t_iStimIndex][0];</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;                                <span class="keywordflow">for</span>(j = 1; j &lt; m_qListQListPreStimBuf[t_iStimIndex].size(); ++j)</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;                                    m_qListPreStimAve[t_iStimIndex] += m_qListQListPreStimBuf[t_iStimIndex][j];</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;                                m_qListPreStimAve[t_iStimIndex].array() /= (double)m_iNumAverages;</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;                                m_qListQListPreStimBuf[t_iStimIndex].pop_front();</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;                            }</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;                            m_qMutex.unlock();</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;                            <span class="comment">//</span></div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;                            <span class="comment">// Poststimulus average</span></div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;                            <span class="comment">//</span></div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;                            m_qMutex.lock();</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;                            <span class="keywordflow">if</span>(m_qListQListPostStimBuf[t_iStimIndex].size() &gt;= m_iNumAverages)</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;                            {</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;                                <span class="keywordflow">while</span>(m_qListQListPostStimBuf[t_iStimIndex].size() &gt;= (m_iNumAverages+1))<span class="comment">//if meanwhile number of averages was reduced</span></div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;                                    m_qListQListPostStimBuf[t_iStimIndex].pop_front();</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;                                m_qListPostStimAve[t_iStimIndex] = m_qListQListPostStimBuf[t_iStimIndex][0];</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;                                <span class="keywordflow">for</span>(j = 1; j &lt; m_qListQListPostStimBuf[t_iStimIndex].size(); ++j)</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;                                    m_qListPostStimAve[t_iStimIndex] += m_qListQListPostStimBuf[t_iStimIndex][j];</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;                                m_qListPostStimAve[t_iStimIndex].array() /= (double)m_iNumAverages;</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;                                m_qListQListPostStimBuf[t_iStimIndex].pop_front();</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;                            }</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;                            m_qMutex.unlock();</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;                            <span class="comment">//if averages are available -&gt; buffers are filled and first average is stored</span></div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;                            m_qMutex.lock();</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;                            <span class="keywordflow">if</span>(m_qListPreStimAve[t_iStimIndex].size() &gt; 0)</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;                            {</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;                                <span class="comment">//</span></div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;                                <span class="comment">// concatenate pre + post stimulus to full stimulus</span></div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;                                <span class="comment">//</span></div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;                                m_qListStimAve[t_iStimIndex].resize(m_qListPreStimAve[t_iStimIndex].rows(), m_qListPreStimAve[t_iStimIndex].cols() + m_qListPostStimAve[t_iStimIndex].cols());</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;                                <span class="comment">// Pre</span></div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;                                m_qListStimAve[t_iStimIndex].block(0,0,m_qListPreStimAve[t_iStimIndex].rows(),m_qListPreStimAve[t_iStimIndex].cols()) = m_qListPreStimAve[t_iStimIndex];</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;                                <span class="comment">// Post</span></div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;                                m_qListStimAve[t_iStimIndex].block(0,m_qListPreStimAve[t_iStimIndex].cols(),m_qListPostStimAve[t_iStimIndex].rows(),m_qListPostStimAve[t_iStimIndex].cols()) = m_qListPostStimAve[t_iStimIndex];</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;                                <span class="comment">//</span></div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;                                <span class="comment">// Emit evoked</span></div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;                                <span class="comment">//</span></div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;                                QString t_sStimChName = m_pFiffInfo-&gt;ch_names[m_qListStimChannelIdcs[t_iStimIndex]];</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;                                <a class="code" href="class_f_i_f_f_l_i_b_1_1_fiff_evoked.html#a427a54548db07d9a54447bf6ba9243ae">FiffEvoked::SPtr</a> t_pEvokedPreStim(<span class="keyword">new</span> <a class="code" href="class_f_i_f_f_l_i_b_1_1_fiff_evoked.html">FiffEvoked</a>(t_preStimEvoked));</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;                                t_pEvokedPreStim-&gt;nave = m_iNumAverages;</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;                                t_pEvokedPreStim-&gt;comment = t_sStimChName;</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;                                t_pEvokedPreStim-&gt;data = m_qListPreStimAve[t_iStimIndex];</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;                                emit <a class="code" href="class_r_t_i_n_v_l_i_b_1_1_rt_ave.html#afcd67cf178d9b292c06aca49a19d77f9">evokedPreStim</a>(t_pEvokedPreStim);</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;                                <a class="code" href="class_f_i_f_f_l_i_b_1_1_fiff_evoked.html#a427a54548db07d9a54447bf6ba9243ae">FiffEvoked::SPtr</a> t_pEvokedPostStim(<span class="keyword">new</span> <a class="code" href="class_f_i_f_f_l_i_b_1_1_fiff_evoked.html">FiffEvoked</a>(t_postStimEvoked));</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;                                t_pEvokedPostStim-&gt;nave = m_iNumAverages;</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;                                t_pEvokedPostStim-&gt;comment = t_sStimChName;</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;                                t_pEvokedPostStim-&gt;data = m_qListPostStimAve[t_iStimIndex];</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;                                emit <a class="code" href="class_r_t_i_n_v_l_i_b_1_1_rt_ave.html#afb6dc4dc94f580f7bf837a2723caac48">evokedPostStim</a>(t_pEvokedPostStim);</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;                                <a class="code" href="class_f_i_f_f_l_i_b_1_1_fiff_evoked.html#a427a54548db07d9a54447bf6ba9243ae">FiffEvoked::SPtr</a> t_pEvokedStim(<span class="keyword">new</span> <a class="code" href="class_f_i_f_f_l_i_b_1_1_fiff_evoked.html">FiffEvoked</a>(t_stimEvoked));</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;                                t_pEvokedStim-&gt;nave = m_iNumAverages;</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;                                t_pEvokedStim-&gt;comment = t_sStimChName;</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;                                t_pEvokedStim-&gt;data = m_qListStimAve[t_iStimIndex];</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;                                emit <a class="code" href="class_r_t_i_n_v_l_i_b_1_1_rt_ave.html#aa4a8b5fc55ee6c1e7d0572f7467f78eb">evokedStim</a>(t_pEvokedStim);</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;                            }</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;                            m_qMutex.unlock();</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;                        }</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;                    }</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;                }</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;                <span class="comment">//</span></div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;                <span class="comment">//dump oldest buffer</span></div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;                <span class="comment">//</span></div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;                t_qListRawMatBuf.pop_front();</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;            }</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;        }</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;    }</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;}</div>
<div class="ttc" id="class_r_t_i_n_v_l_i_b_1_1_rt_ave_html_ab905110d161ee2a62dc32f4812ecf9b0"><div class="ttname"><a href="class_r_t_i_n_v_l_i_b_1_1_rt_ave.html#ab905110d161ee2a62dc32f4812ecf9b0">RTINVLIB::RtAve::RtAve</a></div><div class="ttdeci">RtAve(quint32 numAverages, quint32 p_iPreStimSamples, quint32 p_iPostStimSamples, FiffInfo::SPtr p_pFiffInfo, QObject *parent=0)</div><div class="ttdef"><b>Definition:</b> <a href="rtave_8cpp_source.html#l00074">rtave.cpp:74</a></div></div>
<div class="ttc" id="class_r_t_i_n_v_l_i_b_1_1_rt_ave_html_afb6dc4dc94f580f7bf837a2723caac48"><div class="ttname"><a href="class_r_t_i_n_v_l_i_b_1_1_rt_ave.html#afb6dc4dc94f580f7bf837a2723caac48">RTINVLIB::RtAve::evokedPostStim</a></div><div class="ttdeci">void evokedPostStim(FIFFLIB::FiffEvoked::SPtr p_pEvokedPostStim)</div></div>
<div class="ttc" id="class_r_t_i_n_v_l_i_b_1_1_rt_ave_html_a9f81dcd3c06945da35e8484113f1e233"><div class="ttname"><a href="class_r_t_i_n_v_l_i_b_1_1_rt_ave.html#a9f81dcd3c06945da35e8484113f1e233">RTINVLIB::RtAve::numAveragesChanged</a></div><div class="ttdeci">void numAveragesChanged()</div></div>
<div class="ttc" id="class_r_t_i_n_v_l_i_b_1_1_rt_ave_html_ad0952166fc5cca924b8bcdfbd9caca2d"><div class="ttname"><a href="class_r_t_i_n_v_l_i_b_1_1_rt_ave.html#ad0952166fc5cca924b8bcdfbd9caca2d">RTINVLIB::RtAve::setPreStim</a></div><div class="ttdeci">void setPreStim(qint32 samples)</div><div class="ttdef"><b>Definition:</b> <a href="rtave_8cpp_source.html#l00122">rtave.cpp:122</a></div></div>
<div class="ttc" id="class_r_t_i_n_v_l_i_b_1_1_rt_ave_html_a6152aaeb0cb1aef0d4cffa21b91ba7ce"><div class="ttname"><a href="class_r_t_i_n_v_l_i_b_1_1_rt_ave.html#a6152aaeb0cb1aef0d4cffa21b91ba7ce">RTINVLIB::RtAve::stop</a></div><div class="ttdeci">virtual bool stop()</div><div class="ttdef"><b>Definition:</b> <a href="rtave_8cpp_source.html#l00308">rtave.cpp:308</a></div></div>
<div class="ttc" id="class_f_i_f_f_l_i_b_1_1_fiff_evoked_html_ab678c64a099131848c27ad92b8c76c37"><div class="ttname"><a href="class_f_i_f_f_l_i_b_1_1_fiff_evoked.html#ab678c64a099131848c27ad92b8c76c37">FIFFLIB::FiffEvoked::nave</a></div><div class="ttdeci">fiff_int_t nave</div><div class="ttdef"><b>Definition:</b> <a href="fiff__evoked_8h_source.html#l00211">fiff_evoked.h:211</a></div></div>
<div class="ttc" id="class_r_t_i_n_v_l_i_b_1_1_rt_ave_html_aa4a8b5fc55ee6c1e7d0572f7467f78eb"><div class="ttname"><a href="class_r_t_i_n_v_l_i_b_1_1_rt_ave.html#aa4a8b5fc55ee6c1e7d0572f7467f78eb">RTINVLIB::RtAve::evokedStim</a></div><div class="ttdeci">void evokedStim(FIFFLIB::FiffEvoked::SPtr p_pEvokedStim)</div></div>
<div class="ttc" id="class_i_o_buffer_1_1_circular_matrix_buffer_html_a27289313f8c9d93db4e02703e2033e8f"><div class="ttname"><a href="class_i_o_buffer_1_1_circular_matrix_buffer.html#a27289313f8c9d93db4e02703e2033e8f">IOBuffer::CircularMatrixBuffer::SPtr</a></div><div class="ttdeci">QSharedPointer&lt; CircularMatrixBuffer &gt; SPtr</div><div class="ttdef"><b>Definition:</b> <a href="circularmatrixbuffer_8h_source.html#l00096">circularmatrixbuffer.h:96</a></div></div>
<div class="ttc" id="class_f_i_f_f_l_i_b_1_1_fiff_evoked_html"><div class="ttname"><a href="class_f_i_f_f_l_i_b_1_1_fiff_evoked.html">FIFFLIB::FiffEvoked</a></div><div class="ttdoc">evoked data </div><div class="ttdef"><b>Definition:</b> <a href="fiff__evoked_8h_source.html#l00091">fiff_evoked.h:91</a></div></div>
<div class="ttc" id="namespace_u_t_i_l_s_l_i_b_html"><div class="ttname"><a href="namespace_u_t_i_l_s_l_i_b.html">UTILSLIB</a></div><div class="ttdef"><b>Definition:</b> <a href="cosinefilter_8h_source.html#l00068">cosinefilter.h:68</a></div></div>
<div class="ttc" id="class_r_t_i_n_v_l_i_b_1_1_rt_ave_html_a17f21c3faa0eeeccae2fc04f9ce9515f"><div class="ttname"><a href="class_r_t_i_n_v_l_i_b_1_1_rt_ave.html#a17f21c3faa0eeeccae2fc04f9ce9515f">RTINVLIB::RtAve::~RtAve</a></div><div class="ttdeci">~RtAve()</div><div class="ttdef"><b>Definition:</b> <a href="rtave_8cpp_source.html#l00089">rtave.cpp:89</a></div></div>
<div class="ttc" id="class_f_i_f_f_l_i_b_1_1_fiff_evoked_html_a44df92f479c19bb5a3806d00844bfa21"><div class="ttname"><a href="class_f_i_f_f_l_i_b_1_1_fiff_evoked.html#a44df92f479c19bb5a3806d00844bfa21">FIFFLIB::FiffEvoked::times</a></div><div class="ttdeci">RowVectorXf times</div><div class="ttdef"><b>Definition:</b> <a href="fiff__evoked_8h_source.html#l00216">fiff_evoked.h:216</a></div></div>
<div class="ttc" id="class_i_o_buffer_1_1_circular_matrix_buffer_html"><div class="ttname"><a href="class_i_o_buffer_1_1_circular_matrix_buffer.html">IOBuffer::CircularMatrixBuffer&lt; double &gt;</a></div></div>
<div class="ttc" id="class_f_i_f_f_l_i_b_1_1_fiff_info_html_abfce6128814de61b3fdd324a97918338"><div class="ttname"><a href="class_f_i_f_f_l_i_b_1_1_fiff_info.html#abfce6128814de61b3fdd324a97918338">FIFFLIB::FiffInfo::SPtr</a></div><div class="ttdeci">QSharedPointer&lt; FiffInfo &gt; SPtr</div><div class="ttdef"><b>Definition:</b> <a href="fiff__info_8h_source.html#l00099">fiff_info.h:99</a></div></div>
<div class="ttc" id="class_f_i_f_f_l_i_b_1_1_fiff_evoked_html_a82f2dbb01653b5bcac2449b2195e4ef7"><div class="ttname"><a href="class_f_i_f_f_l_i_b_1_1_fiff_evoked.html#a82f2dbb01653b5bcac2449b2195e4ef7">FIFFLIB::FiffEvoked::aspect_kind</a></div><div class="ttdeci">fiff_int_t aspect_kind</div><div class="ttdef"><b>Definition:</b> <a href="fiff__evoked_8h_source.html#l00212">fiff_evoked.h:212</a></div></div>
<div class="ttc" id="class_i_o_buffer_1_1_circular_matrix_buffer_html_adbba1720803e03e6b1bcd6b37f884f09"><div class="ttname"><a href="class_i_o_buffer_1_1_circular_matrix_buffer.html#adbba1720803e03e6b1bcd6b37f884f09">IOBuffer::CircularMatrixBuffer::push</a></div><div class="ttdeci">void push(const Matrix&lt; _Tp, Dynamic, Dynamic &gt; *pMatrix)</div><div class="ttdef"><b>Definition:</b> <a href="circularmatrixbuffer_8h_source.html#l00236">circularmatrixbuffer.h:236</a></div></div>
<div class="ttc" id="class_i_o_buffer_1_1_circular_matrix_buffer_html_a2a2115cde980084c54c138b00b3a2273"><div class="ttname"><a href="class_i_o_buffer_1_1_circular_matrix_buffer.html#a2a2115cde980084c54c138b00b3a2273">IOBuffer::CircularMatrixBuffer::releaseFromPop</a></div><div class="ttdeci">bool releaseFromPop()</div><div class="ttdef"><b>Definition:</b> <a href="circularmatrixbuffer_8h_source.html#l00341">circularmatrixbuffer.h:341</a></div></div>
<div class="ttc" id="rtave_8h_html"><div class="ttname"><a href="rtave_8h.html">rtave.h</a></div><div class="ttdoc">RtAve class declaration. </div></div>
<div class="ttc" id="class_f_i_f_f_l_i_b_1_1_fiff_evoked_html_a427a54548db07d9a54447bf6ba9243ae"><div class="ttname"><a href="class_f_i_f_f_l_i_b_1_1_fiff_evoked.html#a427a54548db07d9a54447bf6ba9243ae">FIFFLIB::FiffEvoked::SPtr</a></div><div class="ttdeci">QSharedPointer&lt; FiffEvoked &gt; SPtr</div><div class="ttdef"><b>Definition:</b> <a href="fiff__evoked_8h_source.html#l00094">fiff_evoked.h:94</a></div></div>
<div class="ttc" id="class_r_t_i_n_v_l_i_b_1_1_rt_ave_html_ad0c3ff5309ee80ce98f869a7f2297e5b"><div class="ttname"><a href="class_r_t_i_n_v_l_i_b_1_1_rt_ave.html#ad0c3ff5309ee80ce98f869a7f2297e5b">RTINVLIB::RtAve::setAverages</a></div><div class="ttdeci">void setAverages(qint32 numAve)</div><div class="ttdef"><b>Definition:</b> <a href="rtave_8cpp_source.html#l00111">rtave.cpp:111</a></div></div>
<div class="ttc" id="class_r_t_i_n_v_l_i_b_1_1_rt_ave_html_af28f7254372398079b00749ebc7c7056"><div class="ttname"><a href="class_r_t_i_n_v_l_i_b_1_1_rt_ave.html#af28f7254372398079b00749ebc7c7056">RTINVLIB::RtAve::setPostStim</a></div><div class="ttdeci">void setPostStim(qint32 samples)</div><div class="ttdef"><b>Definition:</b> <a href="rtave_8cpp_source.html#l00131">rtave.cpp:131</a></div></div>
<div class="ttc" id="fiff__constants_8h_html_a5dab727c9be8983aee7be8d73fabe64e"><div class="ttname"><a href="fiff__constants_8h.html#a5dab727c9be8983aee7be8d73fabe64e">FIFFV_ASPECT_AVERAGE</a></div><div class="ttdeci">#define FIFFV_ASPECT_AVERAGE</div><div class="ttdef"><b>Definition:</b> <a href="fiff__constants_8h_source.html#l00421">fiff_constants.h:421</a></div></div>
<div class="ttc" id="class_i_o_buffer_1_1_circular_matrix_buffer_html_ad22568c8be8da160dd52a98cf5f4fd46"><div class="ttname"><a href="class_i_o_buffer_1_1_circular_matrix_buffer.html#ad22568c8be8da160dd52a98cf5f4fd46">IOBuffer::CircularMatrixBuffer::pop</a></div><div class="ttdeci">Matrix&lt; _Tp, Dynamic, Dynamic &gt; pop()</div><div class="ttdef"><b>Definition:</b> <a href="circularmatrixbuffer_8h_source.html#l00257">circularmatrixbuffer.h:257</a></div></div>
<div class="ttc" id="class_r_t_i_n_v_l_i_b_1_1_rt_ave_html_afcd67cf178d9b292c06aca49a19d77f9"><div class="ttname"><a href="class_r_t_i_n_v_l_i_b_1_1_rt_ave.html#afcd67cf178d9b292c06aca49a19d77f9">RTINVLIB::RtAve::evokedPreStim</a></div><div class="ttdeci">void evokedPreStim(FIFFLIB::FiffEvoked::SPtr p_pEvokedPreStim)</div></div>
<div class="ttc" id="namespace_f_i_f_f_l_i_b_html"><div class="ttname"><a href="namespace_f_i_f_f_l_i_b.html">FIFFLIB</a></div><div class="ttdef"><b>Definition:</b> <a href="fiff_8h_source.html#l00098">fiff.h:98</a></div></div>
<div class="ttc" id="class_f_i_f_f_l_i_b_1_1_fiff_evoked_html_aebf8281e73a32ed0a7a21b3e4dbc399e"><div class="ttname"><a href="class_f_i_f_f_l_i_b_1_1_fiff_evoked.html#aebf8281e73a32ed0a7a21b3e4dbc399e">FIFFLIB::FiffEvoked::last</a></div><div class="ttdeci">fiff_int_t last</div><div class="ttdef"><b>Definition:</b> <a href="fiff__evoked_8h_source.html#l00214">fiff_evoked.h:214</a></div></div>
<div class="ttc" id="class_r_t_i_n_v_l_i_b_1_1_rt_ave_html_a93644080694b38ba14f990525828f6e1"><div class="ttname"><a href="class_r_t_i_n_v_l_i_b_1_1_rt_ave.html#a93644080694b38ba14f990525828f6e1">RTINVLIB::RtAve::append</a></div><div class="ttdeci">void append(const MatrixXd &amp;p_DataSegment)</div><div class="ttdef"><b>Definition:</b> <a href="rtave_8cpp_source.html#l00098">rtave.cpp:98</a></div></div>
<div class="ttc" id="namespace_r_t_i_n_v_l_i_b_html"><div class="ttname"><a href="namespace_r_t_i_n_v_l_i_b.html">RTINVLIB</a></div><div class="ttdef"><b>Definition:</b> <a href="rtave_8h_source.html#l00089">rtave.h:89</a></div></div>
<div class="ttc" id="class_r_t_i_n_v_l_i_b_1_1_rt_ave_html_a9ecd23e84e0ebb1669250506957ac4d3"><div class="ttname"><a href="class_r_t_i_n_v_l_i_b_1_1_rt_ave.html#a9ecd23e84e0ebb1669250506957ac4d3">RTINVLIB::RtAve::start</a></div><div class="ttdeci">virtual bool start()</div><div class="ttdef"><b>Definition:</b> <a href="rtave_8cpp_source.html#l00290">rtave.cpp:290</a></div></div>
<div class="ttc" id="ioutils_8h_html"><div class="ttname"><a href="ioutils_8h.html">ioutils.h</a></div><div class="ttdoc">IOUtils class declaration. </div></div>
<div class="ttc" id="class_i_o_buffer_1_1_circular_matrix_buffer_html_af61689beb6325a34564e76ccc674487a"><div class="ttname"><a href="class_i_o_buffer_1_1_circular_matrix_buffer.html#af61689beb6325a34564e76ccc674487a">IOBuffer::CircularMatrixBuffer::clear</a></div><div class="ttdeci">void clear()</div><div class="ttdef"><b>Definition:</b> <a href="circularmatrixbuffer_8h_source.html#l00290">circularmatrixbuffer.h:290</a></div></div>
<div class="ttc" id="class_f_i_f_f_l_i_b_1_1_fiff_evoked_html_a3dcfd87f13c3c3321e463d9d9f5ce2da"><div class="ttname"><a href="class_f_i_f_f_l_i_b_1_1_fiff_evoked.html#a3dcfd87f13c3c3321e463d9d9f5ce2da">FIFFLIB::FiffEvoked::first</a></div><div class="ttdeci">fiff_int_t first</div><div class="ttdef"><b>Definition:</b> <a href="fiff__evoked_8h_source.html#l00213">fiff_evoked.h:213</a></div></div>
<div class="ttc" id="class_f_i_f_f_l_i_b_1_1_fiff_evoked_html_a937ba053abbed8b852277572379a3529"><div class="ttname"><a href="class_f_i_f_f_l_i_b_1_1_fiff_evoked.html#a937ba053abbed8b852277572379a3529">FIFFLIB::FiffEvoked::setInfo</a></div><div class="ttdeci">void setInfo(FiffInfo &amp;p_info, bool proj=true)</div><div class="ttdef"><b>Definition:</b> <a href="fiff__evoked_8cpp_source.html#l00494">fiff_evoked.cpp:494</a></div></div>
<div class="ttc" id="class_r_t_i_n_v_l_i_b_1_1_rt_ave_html_abf42ab0f2d2112f712771a553f48e252"><div class="ttname"><a href="class_r_t_i_n_v_l_i_b_1_1_rt_ave.html#abf42ab0f2d2112f712771a553f48e252">RTINVLIB::RtAve::isRunning</a></div><div class="ttdeci">bool isRunning()</div><div class="ttdef"><b>Definition:</b> <a href="rtave_8h_source.html#l00284">rtave.h:284</a></div></div>
<div class="ttc" id="class_r_t_i_n_v_l_i_b_1_1_rt_ave_html_aa1d073fcf7b624bf8e6d4cf9aef9c3e2"><div class="ttname"><a href="class_r_t_i_n_v_l_i_b_1_1_rt_ave.html#aa1d073fcf7b624bf8e6d4cf9aef9c3e2">RTINVLIB::RtAve::run</a></div><div class="ttdeci">virtual void run()</div><div class="ttdef"><b>Definition:</b> <a href="rtave_8cpp_source.html#l00324">rtave.cpp:324</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Fri Mar 27 2015 22:54:32 for MNE-CPP by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.9.1
</small></address>
</body>
</html>
